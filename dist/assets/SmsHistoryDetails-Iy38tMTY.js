import{A as $,u as M,a as U,r as i,j as e,B as w,I as A,b as f}from"./index--FpPv6_1.js";import{h as m}from"./moment-C5S46NFB.js";import{S as Y,a as H,b as P,c as _,d as z,f as O,e as N}from"./Select-DDdZlMlL.js";import"./index-BzNKqasO.js";import"./index-DiOThvEn.js";const R=()=>{const h=M(),{id:d}=U(),[u,y]=i.useState([]),[v,C]=i.useState({}),[p,E]=i.useState("All"),[S,G]=i.useState(10),[T,W]=i.useState(1),[k,F]=i.useState(0),b=localStorage.getItem("token");i.useEffect(()=>{const t=async()=>{try{const s=await f.get(`/api/history/admin-api/transaction-history-data/get-transaction-history-admin?userId=${d}`,{headers:{Authorization:`Bearer ${b}`}}),l=Array.isArray(s.data)?s.data:[];y(l);const a=l.filter(o=>o.status==="SUCCESS"&&o.otp.length>0).reduce((o,D)=>o+(parseFloat(D.price)||0),0);console.log(a),F(a),console.log(Array.isArray(s.data)?s.data:[])}catch(s){console.error("Failed to fetch SMS history details:",s)}},r=async()=>{try{const s=await f.get(`/api/user/user-admin-api/get-user?userId=${d}`,{headers:{Authorization:`Bearer ${b}`}});C(s.data)}catch{console.error("Failed to fetch user data")}};t(),r()},[d]);let x=(t=>{if(!Array.isArray(t))return[];const r=t.reduce((l,a)=>(l[a.id]||(l[a.id]=[]),l[a.id].push(a),l),{});return Object.values(r).map(l=>{const a=l.filter(c=>c.status==="SUCCESS"),o=l.filter(c=>c.status==="CANCELLED");return{...o.length>0?o[0]:a.find(c=>c.otp.length>0)||a[0],otp:a.flatMap(c=>c.otp).join("<br><br>")||"-"}})})(u);p==="Success"?x=x.filter(t=>t.status==="SUCCESS"):p==="Cancelled"&&(x=x.filter(t=>t.status==="CANCELLED"));const j=x.filter(t=>t.date_time).sort((t,r)=>m(r.date_time).diff(m(t.date_time))),B=t=>{if(t.length===0)return"No data available";const r=t.map(a=>m(a.date_time)),s=m.min(r),l=m.max(r);return`${s.format("DD/MM/YY")} - ${l.format("DD/MM/YY")}`},g=(T-1)*S,I=j.slice(g,g+S),L=async t=>{try{await f.delete(`/api/history/delete-numberhistory?id=${t}`,{headers:{Authorization:`Bearer ${b}`}}),y(r=>r.filter(s=>s.ID!==t))}catch(r){console.error("Failed to delete SMS history:",r)}},n={wordBreak:"break-word",whiteSpace:"normal",overflowWrap:"break-word"};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full my-4 flex items-center justify-between",children:e.jsxs(w,{variant:"link",onClick:()=>h(`/users-data/${d}`),className:"text-sm font-normal text-[#8C8C8C] !no-underline p-1 h-0 flex gap-2",children:[e.jsx(A.arrowLeft,{className:"w-4 h-4"})," Sms History Details"]})}),e.jsx("div",{className:"flex items-center justify-center pt-[1rem]",children:e.jsxs("div",{className:"bg-transparent w-full max-w-md rounded-lg mb-[60px] border-none dark",children:[e.jsxs("div",{className:"bg-[#484848] text-sm py-3 px-5 flex mb-4 w-full items-center justify-between rounded-lg",children:[e.jsx("h3",{className:"font-medium pr-4 border-r",children:"Email"}),e.jsx("p",{className:"font-normal pl-4 text-[#9B9B9B]",style:n,children:v.email})]}),e.jsxs("div",{className:"flex items-center justify-center  w-full max-w-md  ",children:[e.jsx(V,{setTranFilter:E,transFilter:p}),e.jsxs("p",{className:"min-w-fit text-sm pr-8  ",children:["Total: ",x.length]}),p==="Success"&&e.jsxs("div",{className:"min-w-fit text-sm",children:["Used Balance: â‚¹",k.toFixed(2)]})]}),e.jsx("div",{className:"flex items-center justify-center gap-4",children:e.jsxs("p",{className:"text-[#A5A5A5] text-sm",children:["Data:"," ",e.jsx("span",{className:"text-white font-normal text-xs",children:B(I)})]})}),j.length>0?j.map((t,r)=>e.jsx("div",{className:"mt-[1.5rem] w-full border-[10px] border-[#444444] rounded-lg",children:e.jsx("table",{className:"w-full table-auto text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"SL No"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",children:r+1})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"ID"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:n,children:t.id})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Number"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:n,children:t.number})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"OTP"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",children:e.jsx("span",{children:t.otp??"N/A"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Date & Time"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:n,children:m(t.date_time).format("DD/MM/YYYY hh:mm:ss A")})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Service"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:n,children:t.service})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Server"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:n,children:t.server})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Price"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:n,children:t.price})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Status"}),e.jsxs("td",{className:"border-b-2 border-[#949494] p-3 flex justify-between items-center",style:n,children:[e.jsx("span",{children:t.status}),e.jsx(w,{onClick:s=>{s.stopPropagation(),L(t.ID)},children:e.jsx(A.trash,{className:"w-4 h-4 text-red-600"})})]})]})]})})},r)):e.jsx("div",{className:"text-center text-[#959595] mt-10 text-lg",children:"No transactions found"})]})})]})},V=({transFilter:h,setTranFilter:d})=>e.jsxs(Y,{value:h,onValueChange:u=>d(u),children:[e.jsx(H,{className:"dark bg-transparent w-fit",children:e.jsx(P,{children:h})}),e.jsx(_,{className:"dark bg-[#1e1e1e]",children:e.jsxs(z,{children:[e.jsx(O,{className:"font-normal",children:"Filter"}),e.jsx(N,{value:"All",children:"All"}),e.jsx(N,{value:"Success",children:"Success"}),e.jsx(N,{value:"Cancelled",children:"Cancelled"})]})})]}),ee=$()(R);export{ee as default};
