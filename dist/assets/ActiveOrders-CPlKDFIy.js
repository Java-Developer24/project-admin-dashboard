import{A as D,u as O,r as l,b as o,j as e,B as h,I as p,S as _,R as L}from"./index--FpPv6_1.js";const M=()=>{const $=O(),[j,m]=l.useState([]),[A,g]=l.useState(!0),[w,C]=l.useState([]),[x,b]=l.useState(""),[y,R]=l.useState(0),[z,v]=l.useState(),d=localStorage.getItem("token");l.useEffect(()=>{u()},[]),l.useEffect(()=>{const t=setInterval(E,1e3);return()=>clearInterval(t)},[w]);const u=async()=>{try{const t=await o.get("/api/history/history-admin-api/get-all-active-orders",{headers:{Authorization:`Bearer ${d}`}}),r=await Promise.all(t.data.map(async s=>{console.log(s);const a=await o.get(`/api/user/user-admin-api/get-user?userId=${s.userId}`,{headers:{Authorization:`Bearer ${d}`}});return console.log(a),{...s,userEmail:a.data.email,apiKey:a.data.api_key}}));m(r),g(!1)}catch(t){console.error("Failed to fetch orders:",t),g(!1)}};l.useEffect(()=>{let t;return y>0&&(t=setInterval(()=>{R(r=>r<=1?(clearInterval(t),0):r-1)},1e3)),()=>{t&&clearInterval(t)}},[y]);const N=t=>{const r=new Date,s=new Date(t)-r;if(s<=0)return"00:00";const a=Math.floor(s/6e4),n=Math.floor(s%6e4/1e3);return`${a<10?"0":""}${a}:${n<10?"0":""}${n}`},T=({expirationTime:t,orderId:r})=>{const[s,a]=l.useState(()=>N(t));return l.useEffect(()=>{const n=()=>{const c=N(t);a(S=>S!==c?(c==="00:00"?v(f=>({...f,[r]:!0})):c.split(":")[0]<="18"&&v(f=>({...f,[r]:!0})),c):S)};n();const i=setInterval(n,1e3);return()=>clearInterval(i)},[t,r]),e.jsx("span",{className:"font-mono",children:s})},k=async(t,r,s,a)=>{try{await o.get("/api/service/cancel-number",{headers:{Authorization:`Bearer ${d}`},params:{api_key:t,Id:r,server:s}}),u(),m(n=>n.filter(i=>i._id!==a))}catch(n){console.error("Failed to cancel order:",n)}},B=async(t,r,s,a,n)=>{try{await o.delete(`/api/user/admin-api/delete-user-number-data/force-delete?userId=${t}&numberId=${r}&number=${s}`,{headers:{Authorization:`Bearer ${d}`}}),await u(),m(i=>i.filter(c=>c._id!==n))}catch(i){console.error("Failed to force delete order:",i)}},I=j.filter(t=>t.userEmail.toLowerCase().includes(x.toLowerCase())),E=async()=>{try{const r=(await Promise.all(j.map(s=>o.get(`/api/history/transaction-history-user?userId=${s.userId}`)))).flatMap(s=>s.data);C(r)}catch(t){console.error("Failed to fetch transactions:",t)}},F=t=>{const r=w.filter(a=>a.Id===t);if(!r.length)return["Waiting for SMS"];const s=r.map(a=>a.otp).filter(a=>a);return s.length?s:["Waiting for SMS"]};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full my-4 flex items-center justify-between",children:e.jsxs(h,{variant:"link",onClick:()=>$("/"),className:"text-sm font-normal text-[#8C8C8C] !no-underline p-1 h-0 flex gap-2",children:[e.jsx(p.arrowLeft,{className:"w-4 h-4"})," Active Orders"]})}),e.jsx("div",{className:"flex items-center justify-center pt-[1rem]",children:e.jsxs("div",{className:"bg-transparent w-full max-w-2xl rounded-lg mb-[60px] border-none dark",children:[e.jsxs("div",{className:"w-full flex bg-[#18191c] rounded-2xl px-2 items-center justify-center h-[50px] mb-3",children:[e.jsx(p.search,{className:"w-4 h-4 text-primary"}),e.jsx("input",{type:"text",placeholder:"Search by email...",value:x,onChange:t=>b(t.target.value),className:"w-[85%] h-[50px] ml-2 text-sm bg-transparent border-0 text-white placeholder:text-primary focus:outline-none"}),x&&e.jsx(p.circleX,{className:"text-primary cursor-pointer",onClick:()=>b("")})]}),A?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx(_,{})}):I.length===0?e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-[#38D9BA] text-2xl font-bold",children:"No"}),e.jsx("span",{className:"text-white text-2xl font-bold ml-2",children:"Active Orders"})]}):I.map(t=>e.jsxs("div",{className:" w-full max-w-[520px] flex flex-col items-center border-2 border-[#1b1d21] bg-[#121315] rounded-2xl p-5 ",children:[e.jsx("div",{className:"border-b border-gray-700 pb-4 mb-4",children:e.jsxs("h3",{className:"text-white text-lg font-semibold",children:["User: ",t.userEmail]})}),e.jsxs("div",{className:"w-full flex flex-col items-center px-4 mb-4 text-sm font-normal gap-y-2",children:[e.jsxs("div",{className:"w-full flex text-center items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Service:"}),e.jsx("span",{className:"text-white",children:t.service})]}),e.jsx("hr",{className:"border-[#888888] border w-full"}),e.jsxs("div",{className:"w-full flex text-center items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Server:"}),e.jsx("span",{className:"text-white",children:t.server})]}),e.jsx("hr",{className:"border-[#888888] border w-full"}),e.jsxs("div",{className:"w-full flex text-center items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Price:"}),e.jsxs("span",{className:"text-white",children:["â‚¹",t.price]})]}),e.jsx("hr",{className:"border-[#888888] border w-full"}),e.jsx("div",{className:"w-full flex border rounded-2xl items-center justify-center h-[45px]",children:e.jsxs("div",{className:"py-4 px-5 flex w-full gap-4 items-center justify-center rounded-lg text-xl font-medium",children:[e.jsx("span",{className:"text-white",children:t.number}),e.jsx("button",{className:"text-primary hover:text-primary/80"})]})}),e.jsx("div",{className:"w-full flex rounded-2xl items-center justify-center h-[60px]",children:e.jsxs("div",{className:"bg-transparent max-w-56 py-4 px-5 flex w-full items-center justify-between rounded-lg",children:[e.jsx("p",{className:" font-normal text-lg	",children:"Remaining Time"}),e.jsx(T,{expirationTime:t.expirationTime,orderId:t._id})]})}),e.jsx("div",{className:"w-full flex bg-[#444444] border-2 border-[#888888] rounded-2xl items-center justify-center max-h-[100px] overflow-y-scroll hide-scrollbar",children:e.jsx("div",{className:"w-full h-full flex flex-col items-center",children:e.jsxs("p",{children:[" ",F(t.Id).map((r,s,a)=>e.jsxs(L.Fragment,{children:[e.jsx("div",{className:"bg-transparent py-4 px-5 flex w-full items-center justify-center",children:e.jsx("h3",{className:"font-normal text-sm",children:r})}),s<a.length-1&&e.jsx("hr",{className:"border-[#888888] border w-full"})]},s))]})})}),e.jsxs("div",{className:"bg-transparent pt-4 flex w-full items-center justify-center gap-4",children:[e.jsx(h,{onClick:()=>B(t.userId,t.Id,t.number,t.server,t._id),className:"w-full bg-red-600 hover:bg-red-700 text-white",children:"Force Delete"}),e.jsx(h,{onClick:()=>k(t.apiKey,t.Id,t.server,t._id),className:"w-full bg-[#38D9BA] hover:bg-[#38D9BA]/80 text-white",children:"Cancel"})]})]})]},t._id))]})})]})},W=D()(M);export{W as default};
